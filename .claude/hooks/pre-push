#!/bin/zsh
# AUTO-GENERATED BY setup-git-hooks.sh

# V5 GUARD: Refuse to run if BEADS_DIR is missing or if local .beads exists
if [[ -z "${BEADS_DIR:-}" ]]; then
    echo "‚ùå [V5 HOOK] PUSH BLOCKED: BEADS_DIR not set in environment."
    exit 1
fi

if [[ -d "$(git rev-parse --show-toplevel)/.beads" ]]; then
    echo "‚ùå [V5 HOOK] PUSH BLOCKED: Local .beads/ directory detected."
    echo "Migration Required: Move state to $BEADS_DIR and delete local .beads/"
    exit 1
fi


# 1. Sync Beads (external DB)
echo "üîÑ [V5 HOOK] Syncing Beads..."
bd sync

# 2. DX Check (Fast validation)
if [[ -f "./Makefile" ]] && grep -q "ci-lite:" Makefile; then
    echo "üß™ [V5 HOOK] Running ci-lite..."
    make ci-lite
else
    echo "‚ö†Ô∏è  [V5 HOOK] No ci-lite target found, skipping validation"
fi

echo "‚úÖ [V5 HOOK] Pre-push checks passed"

