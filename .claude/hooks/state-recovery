#!/bin/zsh
# AUTO-GENERATED BY setup-git-hooks.sh

# V5 GUARD: Refuse to run if BEADS_DIR is missing or if local .beads exists
if [[ -z "${BEADS_DIR:-}" ]]; then
    echo "‚ùå [V5 HOOK] PUSH BLOCKED: BEADS_DIR not set in environment."
    exit 1
fi

if [[ -d "$(git rev-parse --show-toplevel)/.beads" ]]; then
    echo "‚ùå [V5 HOOK] PUSH BLOCKED: Local .beads/ directory detected."
    echo "Migration Required: Move state to $BEADS_DIR and delete local .beads/"
    exit 1
fi


echo "üîÑ [V5 HOOK] Post-merge sync..."
# If this repo has AGENTS.md, regenerate it
if [[ -f "./Makefile" ]] && grep -q "regenerate-agents-md:" Makefile; then
    make regenerate-agents-md
fi

# Fetch baseline if possible
if [[ -f "./Makefile" ]] && grep -q "baseline-sync:" Makefile; then
    # Usually schedule-only, but can run on merge
    # make baseline-sync
fi

echo "‚úÖ [V5 HOOK] Post-merge complete"

